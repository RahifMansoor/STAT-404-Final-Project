"0","# Function to calculate power"
"0","calc_power <- function(p1, p2, n, reps = 1000, alpha = 0.05) {"
"0","  results <- replicate(reps, {"
"0","    data <- sim_binary_data(p1, p2, n, n)"
"0","    perm_results <- permutation_test(data, 100)"
"0","    p_value <- mean(abs(perm_results$null_dist) >= abs(perm_results$obs_stat))"
"0","    p_value <= alpha"
"0","  })"
"0","  mean(results)"
"0","}"
"0",""
"0","# Calculate power for different sample sizes"
"0","n_seq <- seq(20, 100, by = 20)"
"0","power_results <- sapply(n_seq, function(n) calc_power(0.7, 0.5, n))"
"0",""
"0","# Plot power curve"
"0","ggplot(data.frame(n = n_seq, power = power_results), aes(x = n, y = power)) +"
"0","  geom_line() +"
"0","  geom_point() +"
"0","  geom_hline(yintercept = 0.8, linetype = ""dashed"", color = ""red"") +"
"0","  labs(x = ""Sample Size per Group"","
"0","       y = ""Power"","
"0","       title = ""Power Analysis for Detecting Difference between p1 = 0.7 and p2 = 0.5"") +"
"0","  theme_minimal()"
